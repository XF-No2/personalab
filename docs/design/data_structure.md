# æ•°æ®å­˜å‚¨ç»“æ„

> **ä¸Šä¸‹æ–‡**ï¼šæœ¬æ–‡æ¡£å®šä¹‰PersonaLabçš„æ‰€æœ‰æ•°æ®ç»“æ„æ ¼å¼ã€‚
> æ¦‚è¦æ¶æ„è§ [DESIGN_OVERVIEW.md](../DESIGN_OVERVIEW.md) ç¬¬2ç« 

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**æœ€åæ›´æ–°**: 2025-10-16

---

## æ¶æ„æ¦‚è§ˆ

PersonaLab é‡‡ç”¨**å¯¹è¯æ–‡ä»¶ä¸­å¿ƒ + é¢„è®¾å¼•ç”¨**æ¶æ„ï¼š

- **å¯¹è¯æ–‡ä»¶**ï¼ˆConversationï¼‰ï¼šæ ¸å¿ƒæ•°æ®ï¼Œå­˜å‚¨çœŸå®å¯¹è¯å†å²å’ŒçŠ¶æ€
- **é¢„è®¾åº“**ï¼ˆPresetsï¼‰ï¼šå¯å¤ç”¨çš„ Prompt æ¨¡å—ï¼ˆè§’è‰²ã€èƒŒæ™¯ã€æ‘˜è¦ç­‰ï¼‰
- **åˆ›å»ºå¯¹è¯æ—¶**ï¼šä»é¢„è®¾åº“å¤åˆ¶å¿«ç…§ï¼Œå¯¹è¯æ‹¥æœ‰ç‹¬ç«‹çš„æ¼”åŒ–çŠ¶æ€

---

## ç›®å½•ç»“æ„

```
data/
â”œâ”€â”€ config.json              # å…¨å±€é…ç½®æ–‡ä»¶
â”‚
â”œâ”€â”€ presets/                 # é¢„è®¾åº“ï¼ˆå¯å¤ç”¨æ¨¡å—ï¼‰
â”‚   â”œâ”€â”€ characters/
â”‚   â”‚   â”œâ”€â”€ alserqi.json
â”‚   â”‚   â””â”€â”€ bob.json
â”‚   â”œâ”€â”€ backgrounds/
â”‚   â”‚   â”œâ”€â”€ wasteland.json
â”‚   â”‚   â””â”€â”€ cyberpunk.json
â”‚   â””â”€â”€ summaries/
â”‚       â””â”€â”€ conv_001_summary.json
â”‚
â”œâ”€â”€ conversations/           # å¯¹è¯æ–‡ä»¶ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ conv_001/
â”‚   â”‚   â”œâ”€â”€ conversation.jsonl      # å¯¹è¯è®°å½•
â”‚   â”‚   â”œâ”€â”€ metadata.json           # å…ƒæ•°æ®ï¼ˆå¼•ç”¨çš„é¢„è®¾ï¼‰
â”‚   â”‚   â”œâ”€â”€ character_snapshot.json # è§’è‰²å¿«ç…§ï¼ˆä¼šæˆé•¿ï¼‰
â”‚   â”‚   â””â”€â”€ plot_state.json         # å‰§æƒ…è¿›åº¦ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ conv_002/
â”‚       â”œâ”€â”€ conversation.jsonl
â”‚       â”œâ”€â”€ metadata.json
â”‚       â””â”€â”€ character_snapshot.json
â”‚
â”œâ”€â”€ event_library/           # äº‹ä»¶åº“ï¼ˆRAGå‘é‡æ•°æ®åº“ï¼‰
â”‚   â””â”€â”€ chroma_db/
â”‚
â””â”€â”€ prompt_templates/        # Prompt æ¨¡æ¿ï¼ˆå¯é…ç½®ï¼‰
```

---

## å¯¹è¯æ–‡ä»¶æ ¼å¼

### conversation.jsonlï¼ˆå¯¹è¯è®°å½•ï¼‰

**é¦–æ¬¡å¯¹è¯ç¤ºä¾‹**ï¼š
```jsonl
{"role":"user","content":"ä½ å¥½","turn":1,"timestamp":"2025-10-16T10:01:00Z"}
{"role":"assistant","content":"ä½ å¥½ï¼Œæœ‰ä»€ä¹ˆäº‹å—ï¼Ÿ","turn":1,"timestamp":"2025-10-16T10:01:05Z"}
{"role":"user","content":"ä½ è¿˜è®°å¾—æˆ‘ä¹‹å‰è¯´çš„è¯å—ï¼Ÿ","turn":2,"timestamp":"2025-10-16T10:02:00Z"}
{"role":"assistant","content":"...","turn":2,"timestamp":"2025-10-16T10:02:05Z"}
```

**æ±‡æ€»åçš„æ–°å¯¹è¯ç¤ºä¾‹**ï¼š
```jsonl
{"type":"summary","content":"æƒ…æŠ¥äº¤æ¢ä¸ä¿¡ä»»å»ºç«‹ã€‚ç”¨æˆ·å‘ŠçŸ¥ Alserqi åŒ—åŒºæ®ç‚¹æœ‰èƒŒå›è€…çš„æƒ…æŠ¥..."}
{"type":"summary","content":"åˆ¶å®šå¤ä»‡è®¡åˆ’ã€‚Alserqi å†³å®šå‰å¾€è°ƒæŸ¥ï¼Œåˆ¶å®šäº†è¯¦ç»†çš„æ½œå…¥è®¡åˆ’..."}
{"role":"user","content":"ä½ ç¡®å®šè¿™ä¸ªè®¡åˆ’å¯è¡Œå—ï¼Ÿ","turn":1,"timestamp":"2025-10-16T11:00:30Z"}
{"role":"assistant","content":"å½“ç„¶ï¼Œæˆ‘å·²ç»è€ƒè™‘äº†æ‰€æœ‰å¯èƒ½çš„é£é™©...","turn":1,"timestamp":"2025-10-16T11:00:35Z"}
```

**æ¶ˆæ¯ç±»å‹å®šä¹‰**ï¼š

| ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|------|------|------|
| `type:"summary"` | `content` | å†å²å‰§æƒ…æ‘˜è¦ï¼ˆæ±‡æ€»åæ–°å¯¹è¯æ‰æœ‰ï¼‰ |
| `role:"user"` | `content`, `turn`, `timestamp` | ç”¨æˆ·æ¶ˆæ¯ |
| `role:"assistant"` | `content`, `turn`, `timestamp` | AIå›å¤ |

**å­—æ®µè¯´æ˜**ï¼š
- `turn`: è½®æ¬¡ç¼–å·ï¼ˆä¸€è½® = ä¸€æ¡ user + ä¸€æ¡ assistantï¼‰ï¼Œä» 1 å¼€å§‹
- `timestamp`: æ¶ˆæ¯æ—¶é—´æˆ³ï¼ˆISO 8601æ ¼å¼ï¼‰
- `content`: æ¶ˆæ¯å†…å®¹ï¼ˆçº¯æ–‡æœ¬ï¼‰

**è¯´æ˜**ï¼š
- æ±‡æ€»åæ–°å¯¹è¯çš„ `turn` ä» 1 é‡æ–°å¼€å§‹ç¼–å·
- æ¶ˆæ¯å†…å®¹æ˜¯çº¯å‡€çš„å¯¹è¯ï¼Œä¸åŒ…å«ä»»ä½•å…ƒä¿¡æ¯æ³¨é‡Š

---

### metadata.jsonï¼ˆå…ƒæ•°æ®ï¼‰

```json
{
  "conversation_id": "conv_001",
  "created_at": "2025-10-16T10:00:00Z",
  "presets": {
    "character": "alserqi",
    "background": "wasteland",
    "summaries": []
  },
  "rag_scope": {
    "mode": "self_only",
    "related_conversations": []
  }
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `conversation_id` | string | å¯¹è¯å”¯ä¸€æ ‡è¯†ç¬¦ |
| `created_at` | string | åˆ›å»ºæ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰ |
| `presets` | object | å½“å‰ä½¿ç”¨çš„é¢„è®¾å¼•ç”¨ |
| `presets.character` | string | è§’è‰²é¢„è®¾ID |
| `presets.background` | string \| null | èƒŒæ™¯é¢„è®¾IDï¼ˆnullè¡¨ç¤ºä¸ä½¿ç”¨èƒŒæ™¯ï¼‰ |
| `presets.summaries` | array | å¼•ç”¨çš„æ‘˜è¦é¢„è®¾IDåˆ—è¡¨ |
| `rag_scope` | object | RAGæ£€ç´¢èŒƒå›´é…ç½®ï¼ˆé¢„ç•™æ‰©å±•ï¼‰ |
| `rag_scope.mode` | string | æ£€ç´¢æ¨¡å¼ï¼ˆV1.0å›ºå®šä¸º"self_only"ï¼‰ |
| `rag_scope.related_conversations` | array | å…³è”çš„å¯¹è¯IDåˆ—è¡¨ï¼ˆé¢„ç•™æ‰©å±•ï¼‰ |

**rag_scope æ‰©å±•è¯´æ˜**ï¼š
- **V1.0**ï¼š`mode = "self_only"`ï¼Œåªæ£€ç´¢å½“å‰å¯¹è¯çš„å†å²äº‹ä»¶
- **V2.0+**ï¼šå¯æ‰©å±•ä¸ºåŸºäºæ ‡ç­¾çš„è¯­ä¹‰æ£€ç´¢ï¼ˆå­—æ®µé¢„ç•™ï¼Œé€»è¾‘å¾…å®šï¼‰

---

### character_snapshot.jsonï¼ˆè§’è‰²å¿«ç…§ï¼‰

```json
{
  "source_preset": "alserqi",
  "snapshot_created_at": "2025-10-16T10:00:00Z",
  "base_persona": "Alserqiï¼ŒåºŸåœŸé»‘å¸®è€å¤§ï¼Œæ›¾ç»æŒæ§åŒ—åŒºï¼Œè¢«å¿ƒè…¹èƒŒå›åå¤±å»ä¸€åˆ‡ã€‚æ ¸å¿ƒç›®æ ‡æ˜¯å¤ä»‡ï¼Œä½†å†…å¿ƒæ·±å¤„æ¸´æœ›é‡å»ºä¿¡ä»»ã€‚æ€§æ ¼åšæ¯…ã€å¤šç–‘ã€é‡æƒ…ä¹‰ã€‚",
  "evolved_persona": ""
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `source_preset` | string | æ¥æºè§’è‰²é¢„è®¾ID |
| `snapshot_created_at` | string | å¿«ç…§åˆ›å»ºæ—¶é—´ |
| `base_persona` | string | åˆå§‹äººæ ¼ï¼ˆä»é¢„è®¾å¤åˆ¶ï¼Œä¸å†å˜åŒ–ï¼‰ |
| `evolved_persona` | string | æˆé•¿äººæ ¼ï¼ˆéšå¯¹è¯æ¼”åŒ–ï¼Œç”¨æˆ·æ‰‹åŠ¨è§¦å‘æ›´æ–°ï¼‰ |

**åˆå§‹åŒ–è§„åˆ™**ï¼š
- åˆ›å»ºå¯¹è¯æ—¶ï¼Œä» `presets/characters/{character_id}.json` å¤åˆ¶ `base_persona`
- `evolved_persona` åˆå§‹ä¸ºç©ºå­—ç¬¦ä¸²
- ç”¨æˆ·æ‰‹åŠ¨è§¦å‘"æ›´æ–°è®°å¿†"åï¼Œ`evolved_persona` æ‰æœ‰å†…å®¹

**æ›´æ–°æœºåˆ¶**ï¼š
- `base_persona` æ°¸ä¸æ”¹å˜
- `evolved_persona` ç”±ç”¨æˆ·æ‰‹åŠ¨è§¦å‘æ›´æ–°ï¼ˆ"ğŸ§  æ›´æ–°è®°å¿†"æŒ‰é’®ï¼‰
- çº¯å®šæ€§æè¿°ï¼Œä¸ä½¿ç”¨é‡åŒ–æ•°å€¼

---

### plot_state.jsonï¼ˆå‰§æƒ…è¿›åº¦ï¼Œå¯é€‰ï¼‰

```json
{
  "enabled": true,
  "current_plot_index": 3,
  "current_status": "in_progress",
  "no_update_count": 2
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `enabled` | boolean | æ˜¯å¦å¯ç”¨å‰§æƒ…å¤§çº²æ§åˆ¶ï¼ˆç”±èƒŒæ™¯é¢„è®¾å†³å®šï¼‰ |
| `current_plot_index` | number | å½“å‰å‰§æƒ…ç‚¹ç´¢å¼•ï¼ˆ1-basedï¼‰ |
| `current_status` | string | å½“å‰å‰§æƒ…ç‚¹çŠ¶æ€ï¼š`completed`, `in_progress`, `pending` |
| `no_update_count` | number | è¿ç»­å¤šå°‘æ¬¡AIå›å¤æ²¡æœ‰è¾“å‡º`[PROGRESS]`æ ‡è®°ï¼ˆç”¨äºè§¦å‘å®¹é”™å¤„ç†ï¼‰ |

**è¯´æ˜**ï¼š
- åªæœ‰ä½¿ç”¨äº†åŒ…å« `story_outline` çš„èƒŒæ™¯é¢„è®¾æ—¶ï¼Œæ‰ä¼šç”Ÿæˆæ­¤æ–‡ä»¶
- å¦‚æœå¯¹è¯ä¸­é€”åˆ‡æ¢èƒŒæ™¯ï¼Œ`plot_state.json` å¯èƒ½å¤±æ•ˆï¼ˆç”¨æˆ·è‡ªè¡Œæ‰¿æ‹…åæœï¼‰

---

## é¢„è®¾åº“æ ¼å¼

### è§’è‰²é¢„è®¾ï¼ˆpresets/characters/*.jsonï¼‰

```json
{
  "character_id": "alserqi",
  "name": "Alserqi",
  "description": "åºŸåœŸé»‘å¸®è€å¤§ï¼Œè¢«èƒŒå›åå¯»æ±‚å¤ä»‡",
  "avatar": "path/to/avatar.png",
  "base_persona": "Alserqiï¼ŒåºŸåœŸé»‘å¸®è€å¤§ï¼Œæ›¾ç»æŒæ§åŒ—åŒºï¼Œè¢«å¿ƒè…¹èƒŒå›åå¤±å»ä¸€åˆ‡ã€‚æ ¸å¿ƒç›®æ ‡æ˜¯å¤ä»‡ï¼Œä½†å†…å¿ƒæ·±å¤„æ¸´æœ›é‡å»ºä¿¡ä»»ã€‚æ€§æ ¼åšæ¯…ã€å¤šç–‘ã€é‡æƒ…ä¹‰ã€‚",
  "created_at": "2025-10-10T10:00:00Z",
  "updated_at": "2025-10-15T15:30:00Z"
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `character_id` | string | è§’è‰²å”¯ä¸€æ ‡è¯†ç¬¦ |
| `name` | string | è§’è‰²åç§° |
| `description` | string | ç®€çŸ­æè¿°ï¼ˆç”¨äºUIå±•ç¤ºï¼‰ |
| `avatar` | string | å¤´åƒè·¯å¾„ï¼ˆå¯é€‰ï¼‰ |
| `base_persona` | string | åˆå§‹äººæ ¼å®šä¹‰ï¼ˆå®Œæ•´æè¿°ï¼‰ |
| `created_at` | string | åˆ›å»ºæ—¶é—´ |
| `updated_at` | string | æœ€åä¿®æ”¹æ—¶é—´ |

**è¯´æ˜**ï¼š
- é¢„è®¾å¯ä»¥è‡ªç”±ä¿®æ”¹/è¿­ä»£
- ä¿®æ”¹é¢„è®¾ä¸ä¼šå½±å“å·²åˆ›å»ºçš„å¯¹è¯ï¼ˆå¯¹è¯ä½¿ç”¨çš„æ˜¯å¿«ç…§ï¼‰

---

### èƒŒæ™¯é¢„è®¾ï¼ˆpresets/backgrounds/*.jsonï¼‰

```json
{
  "background_id": "wasteland",
  "name": "åºŸåœŸå¤ä»‡è®°",
  "description": "æ ¸æˆ˜åçš„åºŸåœŸä¸–ç•Œï¼Œèµ„æºåŒ®ä¹ï¼Œå¼ºè€…ä¸ºç‹",
  "world_setting": "æ ¸æˆ˜åçš„åºŸåœŸä¸–ç•Œï¼Œèµ„æºåŒ®ä¹ï¼Œå¼ºè€…ä¸ºç‹ã€‚å¹¸å­˜è€…èšé›†åœ¨å‡ ä¸ªä¸»è¦æ®ç‚¹ï¼Œå¸®æ´¾ä¹‹é—´äº‰å¤ºæ§åˆ¶æƒã€‚ä½ æ˜¯ä¸€ä¸ªè¢«èƒŒå›çš„å‰å¸®æ´¾è€å¤§ï¼Œç°åœ¨è¦å¤ä»‡ã€‚",
  "story_outline": [
    {"index": 1, "content": "å‘ç°èƒŒå›è€…çš„çº¿ç´¢"},
    {"index": 2, "content": "æ½œå…¥æ•Œäººæ®ç‚¹"},
    {"index": 3, "content": "ä¸ä»‡äººå¯¹å³™"},
    {"index": 4, "content": "åšå‡ºå…³é”®é€‰æ‹©ï¼ˆæ€/æ”¾/åˆä½œï¼‰"},
    {"index": 5, "content": "åº”å¯¹é€‰æ‹©çš„åæœ"}
  ],
  "created_at": "2025-10-10T10:00:00Z",
  "updated_at": "2025-10-15T15:30:00Z"
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `background_id` | string | èƒŒæ™¯å”¯ä¸€æ ‡è¯†ç¬¦ |
| `name` | string | èƒŒæ™¯åç§° |
| `description` | string | ç®€çŸ­æè¿°ï¼ˆç”¨äºUIå±•ç¤ºï¼‰ |
| `world_setting` | string | ä¸–ç•Œè®¾å®šï¼ˆå®Œæ•´æè¿°ï¼‰ |
| `story_outline` | array | æ•…äº‹ä¸»çº¿å¤§çº²ï¼ˆå¯é€‰ï¼Œä¸ºç©ºåˆ™ä¸å¯ç”¨å¯¼æ¼”æ¨¡å—ï¼‰ |
| `created_at` | string | åˆ›å»ºæ—¶é—´ |
| `updated_at` | string | æœ€åä¿®æ”¹æ—¶é—´ |

**story_outline æ•°ç»„å…ƒç´ **ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `index` | number | å¤§çº²ç‚¹ç´¢å¼•ï¼ˆ1-basedï¼Œé¡ºåºç¼–å·ï¼‰ |
| `content` | string | å¤§çº²ç‚¹å†…å®¹æè¿° |

**è¯´æ˜**ï¼š
- `story_outline` ä¸ºç©ºæ•°ç»„æˆ–çœç•¥æ—¶ï¼Œä¸å¯ç”¨å¯¼æ¼”æ¨¡å—
- å¤§çº²ç‚¹æ•°é‡çµæ´»ï¼Œç”±ç”¨æˆ·è‡ªç”±ç¼–å†™

---

### æ‘˜è¦é¢„è®¾ï¼ˆpresets/summaries/*.jsonï¼‰

```json
{
  "summary_id": "conv_001_summary",
  "source_conversation": "conv_001",
  "created_at": "2025-10-16T12:00:00Z",
  "summaries": [
    {
      "index": 1,
      "content": "æƒ…æŠ¥äº¤æ¢ä¸ä¿¡ä»»å»ºç«‹ã€‚ç”¨æˆ·å‘ŠçŸ¥ Alserqi åŒ—åŒºæ®ç‚¹æœ‰èƒŒå›è€…çš„æƒ…æŠ¥..."
    },
    {
      "index": 2,
      "content": "åˆ¶å®šå¤ä»‡è®¡åˆ’ã€‚Alserqi å†³å®šå‰å¾€è°ƒæŸ¥ï¼Œåˆ¶å®šäº†è¯¦ç»†çš„æ½œå…¥è®¡åˆ’..."
    }
  ]
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `summary_id` | string | æ‘˜è¦å”¯ä¸€æ ‡è¯†ç¬¦ |
| `source_conversation` | string | æ¥æºå¯¹è¯ID |
| `created_at` | string | ç”Ÿæˆæ—¶é—´ |
| `summaries` | array | æƒ…èŠ‚ç‚¹æ‘˜è¦åˆ—è¡¨ |

**è¯´æ˜**ï¼š
- ç”±æ±‡æ€»åŠŸèƒ½è‡ªåŠ¨ç”Ÿæˆ
- å¯ä»¥è¢«å…¶ä»–å¯¹è¯å¼•ç”¨ï¼ˆä½œä¸ºå†å²ç»éªŒï¼‰

---

## Chromaå‘é‡åº“æ ¼å¼

### Summaries Collectionï¼ˆæƒ…èŠ‚ç‚¹æ‘˜è¦ï¼‰

**Documentç»“æ„**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | string | `summary_{conversation_id}_{index}` |
| `content` | string | æƒ…èŠ‚ç‚¹æ‘˜è¦æ–‡æœ¬ |
| `metadata` | object | å…ƒæ•°æ®ï¼ˆè§ä¸‹è¡¨ï¼‰ |

**Metadataå­—æ®µ**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `conversation_id` | string | æ‰€å±å¯¹è¯ID |
| `character_preset` | string | è§’è‰²é¢„è®¾ID |
| `background_preset` | string | èƒŒæ™¯é¢„è®¾ID |
| `related_plot_id` | string | å…³è”çš„è¯¦ç»†ç´ æIDï¼ˆé¢„ç•™æ‰©å±•ï¼‰ |

**è¯´æ˜**ï¼š
- V1.0 RAGæ£€ç´¢åŸºäº `conversation_id` è¿‡æ»¤ï¼ˆåªæ£€ç´¢å½“å‰å¯¹è¯ï¼‰
- V2.0+ å¯åŸºäº `character_preset` + `background_preset` è¿›è¡Œè¯­ä¹‰æ£€ç´¢ï¼ˆé¢„ç•™æ‰©å±•ï¼‰

### Plots Collectionï¼ˆè¯¦ç»†å‰§æƒ…ç´ æï¼Œé¢„ç•™æ‰©å±•ï¼‰

**è¯´æ˜**ï¼š
- V1.0 æš‚ä¸å®ç°æ·±åº¦æœç´¢ï¼ŒPlots Collection é¢„ç•™ä½†ä¸ä½¿ç”¨
- æ•°æ®ç»“æ„ä¸ Summaries Collection ç±»ä¼¼ï¼Œä½† `content` å­—æ®µå­˜å‚¨è¯¦ç»†å‰§æƒ…ç´ æ

---

## é…ç½®æ–‡ä»¶æ ¼å¼ï¼ˆconfig.jsonï¼‰

```json
{
  "features": {
    "director_plot_control": {
      "enabled": true,
      "rag_fallback_threshold": 3
    }
  },
  "summary": {
    "order": "summary_first",
    "last_n_turns": 5
  },
  "conversation_file": {
    "load_all": true,
    "max_tokens": 100000
  }
}
```

### å­—æ®µè¯´æ˜

#### features.director_plot_control

| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `enabled` | boolean | `true` | å‰§æƒ…å¤§çº²æ§åˆ¶åŠŸèƒ½å¼€å…³ |
| `rag_fallback_threshold` | number | `3` | è§¦å‘å®¹é”™å¤„ç†çš„é˜ˆå€¼ï¼ˆè¿ç»­å¤šå°‘æ¬¡æœªæ›´æ–°ï¼‰ |

#### summary

| å­—æ®µ | ç±»å‹ | å¯é€‰å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `order` | string | `summary_first`, `last_n_first` | æ±‡æ€»åæ–°å¯¹è¯çš„åˆå§‹å†…å®¹é¡ºåº |
| `last_n_turns` | number | - | æ±‡æ€»åæ–°å¯¹è¯ä¿ç•™å¤šå°‘è½®å¯¹è¯ |

#### conversation_file

| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `load_all` | boolean | `true` | æ˜¯å¦å…¨é‡è¯»å–å¯¹è¯æ–‡ä»¶ |
| `max_tokens` | number | `100000` | å¯¹è¯æ–‡ä»¶çš„æœ€å¤§tokenæ•°ï¼ˆé¢„ç•™ï¼‰ |

---

## å˜æ›´è®°å½•

### v2.0 (2025-10-16)
- ğŸ”„ **æ¶æ„é‡æ„**ï¼šä»"ä¼šè¯å®ä¾‹"æ”¹ä¸º"å¯¹è¯æ–‡ä»¶ + é¢„è®¾å¼•ç”¨"
- âŒ **åˆ é™¤**ï¼šinstance_state.json, character_state.jsonï¼ˆæ”¹ä¸º character_snapshot.jsonï¼‰
- ğŸ†• **æ–°å¢**ï¼šmetadata.jsonï¼ˆè®°å½•é¢„è®¾å¼•ç”¨å’ŒRAGèŒƒå›´ï¼‰
- ğŸ†• **æ–°å¢**ï¼šé¢„è®¾åº“ç»“æ„ï¼ˆcharacters, backgrounds, summariesï¼‰
- ğŸ“ **ç®€åŒ–**ï¼šRAGæ£€ç´¢åŸºäº conversation_idï¼ˆV1.0ï¼‰ï¼Œé¢„ç•™è¯­ä¹‰æ ‡ç­¾æ‰©å±•ï¼ˆV2.0+ï¼‰

### v1.0 (2025-10-16)
- åˆå§‹ç‰ˆæœ¬ï¼ˆä¼šè¯å®ä¾‹æ¶æ„ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**æœ€åæ›´æ–°**: 2025-10-16
